<?php /** @var M2E_E2M_Block_Adminhtml_Main $this */ // @codingStandardsIgnoreFile ?>

<script type="text/javascript">

    var e2m = {};

    //----------------------------------------

    e2m.localStorage = {};
    e2m.prefix = 'm2e_e2m';
    e2m.url = {};

    //----------------------------------------

    e2m.url.skin = '<?php echo $this->getSkinUrl('e2m'); ?>';
    e2m.url.linkEbayAccount = '<?php echo $this->getUrl('*/e2m/linkEbayAccount'); ?>';
    e2m.url.unlinkEbayAccount = '<?php echo $this->getUrl('*/e2m/unlinkEbayAccount'); ?>';
    e2m.url.startEbayDownloadInventory = '<?php echo $this->getUrl('*/e2m/startEbayDownloadInventory'); ?>';
    e2m.url.getAttributesBySetId = '<?php echo $this->getUrl('*/e2m/getAttributesBySetId'); ?>';
    e2m.url.setSettings = '<?php echo $this->getUrl('*/e2m/setSettings') ?>';
    e2m.url.getAttributes = '<?php echo $this->getUrl('*/e2m/getAttributes') ?>';

    e2m.url.collectInventoryMagmi = '<?php echo $this->getUrl('*/e2m/collectInventoryMagmi') ?>';
    e2m.url.collectInventoryBaseM2 = '<?php echo $this->getUrl('*/e2m/collectInventoryBaseM2') ?>';
    e2m.url.collectInventoryBaseM1 = '<?php echo $this->getUrl('*/e2m/collectInventoryBaseM1') ?>';
    e2m.url.collectAttributesM2 = '<?php echo $this->getUrl('*/e2m/collectAttributesM2') ?>';
    e2m.url.collectAttributesM1 = '<?php echo $this->getUrl('*/e2m/collectAttributesM1') ?>';
    e2m.url.collectAttributesCSV = '<?php echo $this->getUrl('*/e2m/collectAttributesCSV') ?>';

    e2m.eBayFields = JSON.parse('<?php echo $this->getCoreHelper()->jsonEncode($this->getDataHelper()->getEbayFields()); ?>');
    e2m.magentoAttributes = JSON.parse('<?php echo str_replace("'", '', $this->getCoreHelper()->jsonEncode($this->getDataHelper()->getMagentoAttributes($this->getDataHelper()->getConfig(M2E_E2M_Helper_Ebay_Config::XML_PATH_PRODUCT_ATTRIBUTE_SET)))); ?>');
    e2m.attributes = JSON.parse('<?php echo empty($this->getDataHelper()->getConfig(M2E_E2M_Helper_Ebay_Config::XML_PATH_PRODUCT_ATTRIBUTE_MAP)) ? '{}' : str_replace("'", '', $this->getCoreHelper()->jsonEncode($this->getDataHelper()->getConfig(M2E_E2M_Helper_Ebay_Config::XML_PATH_PRODUCT_ATTRIBUTE_MAP))); ?>');
</script>

<div class="content-header">
    <table cellspacing="0">
        <tr>
            <td>
                <h3><?php echo $this->getDataHelper()->__('eBay Data Import'); ?></h3>
                <?php if (!empty($this->getEbayAccount()->getUserId())): ?>
                    <div style="float: right">
                        <label><?php echo $this->getDataHelper()->__('eBay User ID'); ?>&nbsp;</label>
                        <span>(<a href="<?php echo $this->escapeHtml($this->getEbayAccount()->getAccountUrl()); ?>"
                                  target="_blank"><?php echo $this->escapeHtml($this->getEbayAccount()->getUserId()); ?></a>)</span>
                        <span><?php echo $this->getChildHtml('unlink_account_button'); ?></span>
                    </div>
                <?php endif; ?>
            </td>
        </tr>
    </table>
</div>

<?php if (empty($this->getEbayAccount()->getUserId())): ?>
    <div class="entry-edit" collapseable="no">
        <div class="entry-edit-head">
            <h4><?php echo $this->getDataHelper()->__('Account links'); ?></h4>
        </div>
        <div class="fieldset">
            <table class="form-list" cellspacing="0" cellpadding="0">
                <tr>
                    <td class="label">
                        <label for="account-mode"><?php echo $this->getDataHelper()->__('Account'); ?>:
                            <span class="required">*</span>
                        </label>
                    </td>
                    <td class="value">
                        <select id="account-mode">
                            <option value=""><?php echo $this->getDataHelper()->__('-- Please Select --'); ?></option>
                            <?php foreach ($this->getEbayAccounts() as $eBayAccount): ?>
                                <option value="<?php echo $eBayAccount->getId(); ?>"><?php echo $this->escapeHtml($eBayAccount->getChildObject()->getUserId()) ?></option>
                            <?php endforeach; ?>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label><?php echo $this->getDataHelper()->__('Grant Access'); ?>:</label>
                    </td>
                    <td class="value">
                        <?php echo $this->getChildHtml('link_account_button'); ?>
                    </td>
                </tr>
            </table>
        </div>
    </div>
<?php endif; ?>

<?php if ($this->getDataHelper()->getConfig(M2E_E2M_Helper_Data::XML_PATH_EBAY_DOWNLOAD_INVENTORY, false)): ?>
    <div class="entry-edit">
        <div class="entry-edit-head">
            <h4><?php echo $this->getDataHelper()->__('Marketplace settings'); ?></h4>
        </div>
        <div class="fieldset">
            <table class="form-list" cellspacing="0" cellpadding="0">
                <?php foreach ($this->getDataHelper()->getConfig(M2E_E2M_Helper_Data::XML_PATH_EBAY_AVAILABLE_MARKETPLACES, array()) as $marketplaceId): ?>
                    <tr>
                        <td class="label">
                            <label for="<?php echo $marketplaceId; ?>"><?php echo $this->getDataHelper()->__($this->getDataHelper()->getMarketplaceTitle($marketplaceId)); ?></label>
                        </td>
                        <td class="value">
                            <select id="<?php echo $marketplaceId; ?>" class="marketplace-store config-input">
                                <option value=""><?php echo $this->getDataHelper()->__('-- Please Select --'); ?></option>
                                <option value="<?php echo M2E_E2M_Helper_Ebay_Config::STORE_SKIP ?>" <?php if ($this->getEbayConfigHelper()->isSkipStore($marketplaceId)) echo ' selected="selected"'; ?>>
                                    Skip
                                </option>
                                <?php foreach ($this->getDataHelper()->getMagentoStores() as $id => $store): ?>
                                    <option value="<?php echo $id; ?>" <?php if ($this->getEbayConfigHelper()->getStoreForMarketplace($marketplaceId) === $id) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__($store); ?></option>
                                <?php endforeach; ?>
                            </select>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </table>
        </div>
    </div>

    <div class="entry-edit">
        <div class="entry-edit-head">
            <h4><?php echo $this->getDataHelper()->__('Product settings'); ?></h4>
        </div>
        <div class="fieldset">
            <table class="form-list" cellspacing="0" cellpadding="0">
                <tr>
                    <td class="label">
                        <label for="attribute-set"><?php echo $this->getDataHelper()->__('Attribute Set') ?>:</label>
                    </td>
                    <td class="value">
                        <select id="attribute-set" class="attribute-set config-input">
                            <option value=""><?php echo $this->getDataHelper()->__('-- Please Select --'); ?></option>
                            <?php foreach ($this->getDataHelper()->getAllAttributeSet() as $id => $title): ?>
                                <option value="<?php echo $id; ?>" <?php if ($id == $this->getDataHelper()->getConfig(M2E_E2M_Helper_Ebay_Config::XML_PATH_PRODUCT_ATTRIBUTE_SET)) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__($title); ?></option>
                            <?php endforeach; ?>
                        </select>
                        <p class="note">
                            <span><?php echo Mage::helper('e2m')->__('Attribute Set'); ?></span>
                        </p>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="inventory-settings-product-identifier"><?php echo $this->getDataHelper()->__('Product SKU'); ?>:</label>
                    </td>
                    <td class="value">
                        <select id="inventory-settings-product-identifier" class="config-input">
                            <option value="<?php echo M2E_E2M_Helper_Ebay_Config::PRODUCT_IDENTIFIER_SKU; ?>" <?php if ($this->getEbayConfigHelper()->isSKUProductIdentifier()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('SKU'); ?></option>
                            <option value="<?php echo M2E_E2M_Helper_Ebay_Config::PRODUCT_IDENTIFIER_MPN; ?>" <?php if ($this->getEbayConfigHelper()->isMPNProductIdentifier()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('MPN'); ?></option>
                            <option value="<?php echo M2E_E2M_Helper_Ebay_Config::PRODUCT_IDENTIFIER_UPC; ?>" <?php if ($this->getEbayConfigHelper()->isUPCProductIdentifier()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('UPC'); ?></option>
                            <option value="<?php echo M2E_E2M_Helper_Ebay_Config::PRODUCT_IDENTIFIER_EAN; ?>" <?php if ($this->getEbayConfigHelper()->isEANProductIdentifier()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('EAN'); ?></option>
                        </select>
                        <p class="note">
                            <span><?php echo Mage::helper('e2m')->__('Product identifier on different marketplaces'); ?></span>
                        </p>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="generate-sku"><?php echo $this->getDataHelper()->__('Generate SKU') ?>:</label>
                    </td>
                    <td class="value">
                        <select id="generate-sku" class="config-input">
                            <option value="1" <?php if ($this->getEbayConfigHelper()->isGenerateSku()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('Yes'); ?></option>
                            <option value="0" <?php if (!$this->getEbayConfigHelper()->isGenerateSku()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('No'); ?></option>
                        </select>
                        <p class="note">
                            <span><?php echo Mage::helper('e2m')->__('Generate SKU (if empty)'); ?></span>
                        </p>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="delete-html"><?php echo $this->getDataHelper()->__('Delete HTML') ?>:</label>
                    </td>
                    <td class="value">
                        <select id="delete-html" class="config-input">
                            <option value="1" <?php if ($this->getEbayConfigHelper()->isDeleteHtml()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('Yes'); ?></option>
                            <option value="0" <?php if (!$this->getEbayConfigHelper()->isDeleteHtml()) echo ' selected="selected"'; ?>><?php echo $this->getDataHelper()->__('No'); ?></option>
                        </select>
                        <p class="note">
                            <span><?php echo Mage::helper('e2m')->__('Clean HTML in Description'); ?></span>
                        </p>
                    </td>
                </tr>

                <tr>
                    <td class="label">
                        <label for="magento-attribute"><?php echo $this->getDataHelper()->__('Magento attributes'); ?>
                            :</label>
                    </td>
                    <td class="value">
                        <select id="magento-attribute" class="ebay-field-magento-attribute config-input">
                            <option value=""></option>
                            <?php foreach ($this->getDataHelper()->getMagentoAttributes($this->getDataHelper()->getConfig(M2E_E2M_Helper_Ebay_Config::XML_PATH_PRODUCT_ATTRIBUTE_SET)) as $code => $title): ?>
                                <option value="<?php echo $code; ?>"><?php echo $this->getDataHelper()->__($title); ?></option>
                            <?php endforeach; ?>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label for="ebay-field"><?php echo $this->getDataHelper()->__('eBay fields'); ?>:</label>
                    </td>
                    <td class="value">
                        <select id="ebay-field" class="ebay-field-magento-attribute config-input">
                            <option value=""></option>
                            <?php foreach ($this->getDataHelper()->getEbayFields() as $code => $title): ?>
                                <option value="<?php echo $code; ?>"><?php echo $this->getDataHelper()->__($title); ?></option>
                            <?php endforeach; ?>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label><?php echo $this->getDataHelper()->__('Import properties'); ?>:</label>
                    </td>
                    <td class="value">
                        <table class="form-list" cellspacing="0" cellpadding="0">
                            <tr>
                                <td class="value">
                                    <label for="ebay-field"><?php echo $this->getDataHelper()->__('eBay fields'); ?></label>
                                </td>
                                <td class="label">
                                    <label for="magento-attribute">/&nbsp;&nbsp;<?php echo $this->getDataHelper()->__('Magento attributes'); ?></label>
                                </td>
                            </tr>
                            <tr>
                                <td class="value">
                                    <div id="field-attribute-list-e"></div>
                                </td>
                                <td class="label">
                                    <div id="field-attribute-list-m"></div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div style="display: none;margin-bottom: 15px" class="config-button">
        <?php echo $this->getChildHtml('send_settings_button'); ?>
    </div>
<?php endif; ?>

<?php if (!empty($this->getEbayAccount()->getUserId())): ?>
    <div class="box-left entry-edit" collapseable="no">
        <div class="entry-edit-head">
            <h4><?php echo $this->getDataHelper()->__('Summary inventory'); ?></h4>
        </div>
        <div class="fieldset">
            <table class="form-list" cellspacing="0" cellpadding="0">
                <tr>
                    <td class="label">
                        <label><?php echo $this->getDataHelper()->__('Variation items'); ?>:</label>
                    </td>
                    <td class="value">
                        <span id="download-inventory-variation-items"><?php echo $this->escapeHtml($this->getDataHelper()->getCacheValue(M2E_E2M_Helper_Data::CACHE_ID_EBAY_INVENTORY_VARIATION_COUNT, 0)); ?></span>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label><?php echo $this->getDataHelper()->__('Simple items'); ?>:</label>
                    </td>
                    <td class="value">
                        <span id="download-inventory-simple-items"><?php echo $this->escapeHtml($this->getDataHelper()->getCacheValue(M2E_E2M_Helper_Data::CACHE_ID_EBAY_INVENTORY_SIMPLE_COUNT, 0)); ?></span>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <label><?php echo $this->getDataHelper()->__('Total items'); ?>:</label>
                    </td>
                    <td class="value">
                        <span id="download-inventory-total-items"><?php echo $this->escapeHtml($this->getDataHelper()->getCacheValue(M2E_E2M_Helper_Data::CACHE_ID_EBAY_INVENTORY_TOTAL_COUNT, 0)) ?></span>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        <?php echo $this->getChildHtml('start_download_inventory_button'); ?>
                    </td>
                    <td class="value block-download-inventory-progress">
                        <span id="download-inventory-progress"><?php echo $this->escapeHtml($this->getDataHelper()->getCacheValue(M2E_e2M_Model_Cron_Task_Ebay_DownloadInventory::CACHE_ID, 0)); ?></span>&nbsp;%
                    </td>
                </tr>
                <?php if ($this->getDataHelper()->getConfig(M2E_E2M_Helper_Data::XML_PATH_EBAY_DOWNLOAD_INVENTORY, false)): ?>
                    <tr>
                        <td class="label">
                            <label><?php echo $this->getDataHelper()->__('Collect attributes (SQL)'); ?>:</label>
                        </td>
                        <td class="value block-download-inventory-progress">
                            <?php echo $this->getChildHtml('collect_attributes_m1_button'); ?>
                        </td>
                        <td id="pause-download-inventory-button" class="value">
                            <?php echo $this->getChildHtml('collect_attributes_m2_button'); ?>
                        </td>
                    </tr>
                    <tr>
                        <td class="label">
                            <label><?php echo $this->getDataHelper()->__('Collect attributes (CSV)'); ?>:</label>
                        </td>
                        <td class="value block-download-inventory-progress">
                            <?php echo $this->getChildHtml('collect_attributes_csv_button'); ?>
                        </td>
                    </tr>
                    <tr>
                        <td class="label">
                            <label><?php echo $this->getDataHelper()->__('Collect inventory'); ?>:</label>
                        </td>
                        <td class="value block-download-inventory-progress">
                            <?php echo $this->getChildHtml('collect_inventory_magmi_button'); ?>
                        </td>
                    </tr>
                    <tr>
                        <td class="label">
                            <label><?php echo $this->getDataHelper()->__('Collect inventory'); ?>:</label>
                        </td>
                        <td class="value block-download-inventory-progress">
                            <?php echo $this->getChildHtml('collect_inventory_base_m1_button'); ?>
                        </td>
                        <td id="pause-download-inventory-button" class="value">
                            <?php echo $this->getChildHtml('collect_inventory_base_m2_button'); ?>
                        </td>
                    </tr>
                <?php endif; ?>
            </table>
        </div>
    </div>
<?php endif; ?>
